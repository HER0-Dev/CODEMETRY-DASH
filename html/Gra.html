<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CODOMETRY</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <link rel="icon" type="icon" href="../html/Logo PROKJEKT KOCOWTY.svg">

    <link rel="stylesheet" href="./css/kox.css">


</head>

<body>

    <div class="wrapper">
        <nav>
            <a href="Glowna.html" class="logo"><img src="../html/Logo PROKJEKT KOCOWTY.svg" alt="logo"></a>
            <h1 class="name"> <a href="Glowna.html">CODEMETRY DASH</a> </h1>
            <input type="checkbox" class="input-checkbox" id="toggle">
            <label for="toggle">Menu</label>
            <div class="menu">
                <ul>
                    <li><a href="Glowna.html" class="li">STRONA GŁÓWNA</a></li>
                    <li><a href="Gra.html" class="li" class="li">GRA</a></li>
                    <li><a href="Regulamin.html" class="li">INFORMACJE</a></li>
                </ul>
            </div>
        </nav>
        <div class="napisBlur">
            <p class="pogo">Ta Gra Nie Obsługuje tej Rozdzielczości</p>
        </div>
        <div class="game">
            <!-- <button type="submit" class="start">START</button> -->
            <canvas id="canvas" width="1280" height="720"></canvas>

        </div>
    </div>

    <script>


        var canvas = document.getElementById("canvas");
        var ctx = canvas.getContext("2d");

        function floor(x, height) {
            this.x = x;
            this.width = 900;
            this.height = height;
        }

        var points = 0;
        var displayPoints = document.createElement("p");
        displayPoints.className = "score";
        displayPoints.innerHTML = "Punkty: " + points;
        document.body.appendChild(displayPoints);

        setInterval(function () {
            points += 100;
            displayPoints.innerHTML = "Punkty: " + points;
        }, 1000);

        document.addEventListener("keydown", function (event) {
            if (event.code === "Space") {
                player.jump();
            }
        });

        var textures = {
            player: new Image(40, 40)
        }

        function render() {
            textures.player.src = "CODEMETRY-DASH\html\Logo PROKJEKT KOCOWTY.svg";
        }

        var world = {
            height: 720,
            width: 1280,
            gravity: 9,
            highestFloor: 250,
            speed: 10,
            distanceTravelled: 0,
            floorTiles: [new floor(0, 140)],
            moveFloor: function () {
                for (index in this.floorTiles) {
                    var tile = this.floorTiles[index];
                    tile.x -= this.speed;
                    this.distanceTravelled += this.speed;
                }
            },

            addFutureTiles: function () {
                if (this.floorTiles.length >= 4) {
                    return;
                }
                var previousTile = this.floorTiles[this.floorTiles.length - 1];
                var randomHeight = Math.floor(Math.random() * (this.highestFloor + 20 + 20)) + 40;
                var leftValue = previousTile.x + previousTile.width;
                var next = new floor(leftValue, randomHeight);
                this.floorTiles.push(next);
            },

            cleanOldTiles: function () {
                for (index in this.floorTiles) {
                    if (this.floorTiles[index].x <= -this.floorTiles[index].width) {
                        this.floorTiles.splice(index, 1);
                    }
                }
            },

            getDistanceToFloor: function (playerX) {
                for (index in this.floorTiles) {
                    var tile = this.floorTiles[index];
                    if (tile.x <= playerX && tile.x + tile.width >= playerX) {
                        return tile.height;
                    }
                }
                return -1;
            },

            tick: function () {
                this.cleanOldTiles();
                this.addFutureTiles();
                this.moveFloor();
            },

            draw: function () {
                ctx.fillStyle = "black";
                ctx.fillRect(0, 0, this.width, this.height);
                for (index in this.floorTiles) {
                    var tile = this.floorTiles[index];
                    var y = world.height - tile.height;
                    ctx.fillStyle = "blue";
                    ctx.fillRect(tile.x, y, tile.width, tile.height);
                }
            },
        };

        var player = {
            x: 160,
            y: 360,
            height: 40,
            width: 40,
            textures: player,
            velocity: 0, // prędkość
            jumpHeight: 70, // wysokość
            jumpCount: 0, // liczba skoków
            maxJumps: 2, //max skoków pod rząd
            applyGravity: function () {
                var platformBelow = world.getDistanceToFloor(this.x);
                this.currentDistanceAboveGround = world.height - this.y - platformBelow;
            },

            processGravity: function () {
                this.velocity += world.gravity; // zwiększenie prędkości
                this.y += this.velocity; // zmiana pozycji gracza
                var floorHeight = world.getDistanceToFloor(this.x, this.width);
                var topYofPlatform = world.height - floorHeight;
                if (this.y > topYofPlatform) {
                    this.y = topYofPlatform;
                    this.velocity = 0;
                    this.jumpCount = 0;
                }
            },

            jump: function () {
                if (this.jumpCount < this.maxJumps) {
                    var radians = (80 * Math.PI) / 180;
                    var jumpVelocity = -this.jumpHeight * Math.sin(radians);
                    this.velocity = jumpVelocity;
                    this.jumpCount++;
                }
            },

            tick: function () {
                this.processGravity();
                this.applyGravity();
            },

            draw: function () {
                ctx.fillStyle = "white";
                ctx.lineWidth = "5";
                ctx.strokeStyle = "blue";
                ctx.stroke();
                ctx.fillRect(player.x, player.y - player.height, this.height, this.width);
            },
        };

        function checkCollision(player, tile) {
            var leftSideOfPlayer = player.x;
            var rightSideOfPlayer = player.x + player.width;
            var topOfPlayer = player.y - player.height;
            var bottomOfPlayer = player.y;
            var leftSideOfTile = tile.x;
            var rightSideOfTile = tile.x + tile.width;
            var topOfTile = world.height - tile.height;
            var bottomOfTile = world.height;

            if (player.x <= 0) {
                cancelAnimationFrame(animationId);
                gameOver = true;
                ctx.font = "50px Arial";
                ctx.fillStyle = "white";
                ctx.fillText("Twój wynik to " + score, canvas.width / 2 - 200, canvas.height / 2);
                restartButton.style.display = "block";
            }

            if (
                rightSideOfPlayer > leftSideOfTile &&
                leftSideOfPlayer < rightSideOfTile &&
                bottomOfPlayer > topOfTile &&
                topOfPlayer < bottomOfTile &&
                leftSideOfPlayer < leftSideOfTile //lewej ściany
            ) {
                return true;
            }

            return false;
        }

        function checkLeftWall(player) {
            for (index in world.floorTiles) {
                var tile = world.floorTiles[index];
                if (checkCollision(player, tile)) {
                    return true;
                }
            }

            return false;
        }

        function tick() {
            player.tick();
            world.tick();
            world.draw();
            player.draw();

            if (points >= 3000) {
                world.speed = 15; // zmiana prędkości gry
            }

            if (points >= 5000) {
                world.speed = 20;
            }

            if (points >= 7000) {
                world.speed = 25;
            }

            if (points >= 9000) {
                world.speed = 30;
            }
            var fps = window.setTimeout("tick()", 1000 / 60);
        }
        tick();
    </script>

    <script src="kox.js"></script>
</body>

</html>